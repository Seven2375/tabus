### 核心业务流程设计

设计 “课程创建→视频分析→数据统计→课程结束” 的完整流程。



#### 1. 课程创建（教师端）

- **接口**：`POST /admin/course/start`
- **参数**：教师姓名、课程名称、班级、开始时间。
- **逻辑**：生成课程 ID，记录`course_info`表。

#### 2. 视频分析（后台异步处理）

- **触发**：课程创建后，上传前后摄像头视频文件。
- **逻辑**：

- - 调用`FFmpeg`截取视频帧。
  - 对每帧调用`EmotionRecordService.recognize`方法，传入课程 ID 和类型（`student`/`teacher`）。
  - 情绪数据自动关联`emotion_record.course_id`和`type`。

#### 3. 课程结束（教师端）

- **接口**：`POST /admin/course/end`
- **参数**：课程 ID、结束时间。
- **逻辑**：

- - 统计该课程下所有学生情绪记录，计算抬头率（抬头帧数 / 总帧数 ×100）。
  - 统计教师情绪记录的均值（如高兴值平均）。
  - 保存统计结果到`classroom_analysis`表。

### 扩展接口开发

新增分析接口，基于课堂数据生成评估报告。

#### 1. 课堂基础数据分析接口

- **接口**：`GET /admin/analysis/{courseId}`
- **返回**：课程基本信息、抬头率、教师情绪均值。
- **示例返回**：**json**

```json
{
  "courseId": 1,
  "teacher": "张老师",
  "courseName": "数学",
  "class": "高三1班",
  "studentRaiseRate": 75.6,
  "teacherHappinessAvg": 28.3,
  "teacherNeutralAvg": 60.1
}
```





#### 2. 教学方式评估接口（结合讨论文本）

- **依赖**：集成 NLP 库（如 HanLP）对讨论文本做情感分析。
- **接口**：`GET /admin/assessment/{courseId}`
- **逻辑**：

- - 统计讨论文本的积极情感占比（积极文本数 / 总文本数）。
  - 若抬头率 > 70% 且积极情感占比 > 60%：“教学方式生动，学生参与度高”。
  - 若抬头率 <50% 且积极情感占比 < 40%：“教学方式较单调，建议增加互动”。

- **示例返回**：

```json
{
  "assessment": "本节课学生抬头率75.6%，讨论积极度68%，教学方式受学生欢迎。"
}
```